<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QuickAttend - Monthly Summary</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='qr.css') }}" />
  <style>
body { 
    font-family: Arial, sans-serif; 
    background: #f7f9fc; 
    padding: 20px; 
}
.student-container { 
    max-width: 700px; 
    margin: auto; 
    background: #fff; 
    padding: 25px; 
    border-radius: 12px; 
    box-shadow: 0px 4px 12px rgba(0,0,0,0.1); 
}
h2 { 
    text-align: center; 
    color: #222; 
}

/* Responsive table wrapper */
.table-wrapper {
    overflow-x: auto; /* horizontal scroll on small screens */
    margin-top: 15px;
}

/* Table styles */
table { 
    width: 100%; 
    border-collapse: collapse; 
    min-width: 400px; /* ensures scroll if mobile too narrow */
}
th, td { 
    padding: 12px; 
    text-align: center; 
    border: 1px solid #ddd;
}
th { 
    background: #1976d2; 
    color: white; 
}
tr:nth-child(even) { 
    background: #f9f9f9; 
}

/* Attendance % progress bar */
.progress-container {
    background: #e0e0e0;
    border-radius: 8px;
    height: 12px;
    width: 100%;
    margin: auto;
}
.progress-bar {
    height: 12px;
    border-radius: 8px;
    background: linear-gradient(90deg, #4caf50, #81c784);
    text-align: right;
    color: white;
    font-size: 10px;
    line-height: 12px;
    padding-right: 4px;
}

/* Back button */
.back-btn { 
    margin-top: 20px; 
    padding: 10px; 
    background: #0091ea; 
    color: white; 
    border: none; 
    border-radius: 8px; 
    cursor: pointer; 
}

/* Optional: smaller font on very small screens */
@media (max-width: 400px) {
    th, td { padding: 8px; font-size: 14px; }
}
</style>

</head>
<body>
<div class="student-container">
  <h2>üìä Monthly Summary</h2>
  <p>Roll No: <span id="rollno"></span></p>
  <div id="monthlySummary" class="table-wrapper"></div>
  <button class="back-btn" onclick="location.href='{{ url_for('student_page') }}'">‚¨Ö Back</button>
</div>

<style>
body { font-family: Arial, sans-serif; background: #f7f9fc; padding: 10px; }
.student-container { max-width: 95%; margin: auto; background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0px 4px 12px rgba(0,0,0,0.1); }
h2 { text-align: center; color: #222; margin-bottom: 10px; }
.table-wrapper { overflow-x: auto; margin-top: 10px; }
table { width: 100%; border-collapse: collapse; min-width: 400px; }
th, td { padding: 10px; text-align: center; border: 1px solid #ddd; }
th { background: #1976d2; color: white; }
tr:nth-child(even) { background: #f9f9f9; }

/* Progress bar */
.progress-container { background: #e0e0e0; border-radius: 8px; height: 12px; width: 100%; }
.progress-bar { height: 12px; border-radius: 8px; background: linear-gradient(90deg, #4caf50, #81c784); text-align: right; color: white; font-size: 10px; line-height: 12px; padding-right: 4px; }

.back-btn { margin-top: 15px; padding: 10px; background: #0091ea; color: white; border: none; border-radius: 8px; cursor: pointer; }

/* Small screen adjustments */
@media(max-width: 400px) { th, td { font-size: 13px; padding: 8px; } }
</style>

<script>
  let rollno = null;

  window.onload = function () {
    const user = JSON.parse(sessionStorage.getItem("user"));
    if (user && user.data) {
      rollno = user.data.roll_number;
      document.getElementById("rollno").textContent = rollno;
    }
    loadMonthlySummary();
  };

  async function loadMonthlySummary() {
    const box = document.getElementById("monthlySummary");
    box.innerHTML = "<p>‚è≥ Loading...</p>";

    try {
      // ‚úÖ Corrected API URL
      const res = await fetch(`https://preroyal-kelly-stuporously.ngrok-free.dev/api/student/${rollno}/monthly`);
      const data = await res.json();

      if (data && data.records && data.records.length > 0) {
        let html = ``;
        html += "<table><tr><th>Subject</th><th>Total Classes</th><th>Attended</th><th>%</th></tr>";

        data.records.forEach(r => {
          html += `<tr>
            <td>${r.subject}</td>
            <td>${r.total_classes}</td>
            <td>${r.attended}</td>
            <td>${r.percentage}%</td>
          </tr>`;
        });

        html += "</table>";
        box.innerHTML = html;
      } else {
        box.innerHTML = "<p>No records for this month</p>";
      }
    } catch (err) {
      console.error(err);
      box.innerHTML = "<p style='color:red;'>Error fetching monthly summary</p>";
    }
  }
</script>

</body>
</html>
